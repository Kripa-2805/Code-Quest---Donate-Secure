{% extends "base.html" %}

{% block title %}NGO Dashboard{% endblock %}

{% block content %}
<!-- Hero Section -->
<section style="
    background: linear-gradient(135deg, #232c51 0%, #39355c 100%);
    border: 2px solid rgba(255,255,255,0.15); 
    box-shadow: 0 15px 40px rgba(44,82,160,0.55);
    border-radius: 24px;
    margin: 2rem auto 2.5rem auto;
    max-width: 800px;
    text-align: center;
    padding: 2.3rem 1.2rem 2rem 1.2rem;
    position: relative;
    ">
    <div style="font-size: 3rem; margin-bottom: 1rem; animation: float 3s ease-in-out infinite;">üè¢</div>
    <h1 style="
        color: #fff;
        font-size: 2.2rem;
        font-weight: 900;
        text-shadow: 0 3px 12px #5172d1;
        margin-bottom: 1rem;
        letter-spacing: 1.2px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
    ">
        {% if ngo %}{{ ngo[2] }}{% else %}Welcome{% endif %}
        {% if ngo %}
            {% if ngo[10] %}
                <span style="
                    background: linear-gradient(45deg, #2ecc71, #27ae60);
                    color: white;
                    padding: 0.3rem 0.8rem;
                    border-radius: 20px;
                    font-size: 0.7rem;
                    font-weight: 500;
                    display: flex;
                    align-items: center;
                    gap: 0.3rem;
                ">
                    <i class="fas fa-check-circle"></i> Verified
                </span>
            {% else %}
                <span style="
                    background: linear-gradient(45deg, #f39c12, #e67e22);
                    color: white;
                    padding: 0.3rem 0.8rem;
                    border-radius: 20px;
                    font-size: 0.7rem;
                    font-weight: 500;
                    display: flex;
                    align-items: center;
                    gap: 0.3rem;
                ">
                    <i class="fas fa-clock"></i> Under Review
                </span>
            {% endif %}
        {% endif %}
    </h1>
    {% if ngo %}
        <p style="
            color: #e0e0ef;
            font-size: 1.1rem;
            text-shadow: 0 2px 8px #1a1a3a;
            font-weight: 400;
            letter-spacing: 0.8px;
            line-height: 1.4;
        ">
            <i class="fas fa-map-marker-alt"></i> {{ ngo[3] }} | 
            <i class="fas fa-envelope"></i> {{ ngo[4] }}
        </p>
    {% endif %}
</section>

{% if not ngo %}
    <!-- If NGO not registered yet -->
    <section style="margin: 3rem auto; max-width: 600px;">
        <div class="card" style="text-align: center; padding: 3rem 2rem;">
            <div style="font-size: 4rem; color: #e74c3c; margin-bottom: 1.5rem;">‚ö†Ô∏è</div>
            <h2 style="color: #e74c3c; margin-bottom: 1rem;">Complete Your Registration</h2>
            <p style="color: #666; margin-bottom: 2rem; font-size: 1.1rem; line-height: 1.6;">
                Please complete your NGO registration to access the dashboard features and start receiving donations.
            </p>
            <a href="{{ url_for('ngo_registration') }}" class="btn" style="
                padding: 15px 30px;
                font-size: 1.1rem;
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
            ">
                <i class="fas fa-edit"></i> Complete Registration
            </a>
        </div>
    </section>
{% else %}

<!-- Statistics Cards -->
<section style="margin: 3rem auto; max-width: 1200px;">
    <div style="
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    ">
        <div style="
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s ease;
        " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(31, 38, 135, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 32px rgba(31, 38, 135, 0.37)';">
            <div style="font-size: 3rem; color: #e74c3c; margin-bottom: 1rem;">üíù</div>
            <div style="font-size: 2.2rem; font-weight: 900; color: #e74c3c; margin-bottom: 0.5rem;">
                ‚Çπ{{ donations|sum(attribute=1)|int or 0 }}
            </div>
            <div style="color: #666; font-size: 1rem; font-weight: 500;">Total Received</div>
        </div>
        
        <div style="
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s ease;
        " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(31, 38, 135, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 32px rgba(31, 38, 135, 0.37)';">
            <div style="font-size: 3rem; color: #3498db; margin-bottom: 1rem;">üë•</div>
            <div style="font-size: 2.2rem; font-weight: 900; color: #3498db; margin-bottom: 0.5rem;">
                {{ donations|length }}
            </div>
            <div style="color: #666; font-size: 1rem; font-weight: 500;">Total Donors</div>
        </div>
        
        <div style="
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s ease;
        " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(31, 38, 135, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 32px rgba(31, 38, 135, 0.37)';">
            <div style="font-size: 3rem; color: #2ecc71; margin-bottom: 1rem;">üìö</div>
            <div style="font-size: 2.2rem; font-weight: 900; color: #2ecc71; margin-bottom: 0.5rem;">
                {{ stories_count or 0 }}
            </div>
            <div style="color: #666; font-size: 1rem; font-weight: 500;">Stories Shared</div>
        </div>
        
        <div style="
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s ease;
        " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(31, 38, 135, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 32px rgba(31, 38, 135, 0.37)';">
            <div style="font-size: 3rem; color: #f39c12; margin-bottom: 1rem;">‚ö°</div>
            <div style="font-size: 2.2rem; font-weight: 900; color: #f39c12; margin-bottom: 0.5rem;">
                {{ urgent_count or 0 }}
            </div>
            <div style="color: #666; font-size: 1rem; font-weight: 500;">Urgent Needs</div>
        </div>
    </div>
</section>

<!-- Quick Actions -->
<section style="margin: 3rem auto; max-width: 1200px;">
    <div class="card" style="padding: 2.5rem;">
        <h2 style="text-align: center; color: #2c3e50; margin-bottom: 2.5rem; font-size: 2rem;">
            ‚ö° Quick Actions
        </h2>
        
        <div style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        ">
            <a href="{{ url_for('add_story') }}" style="
                background: white;
                border-radius: 15px;
                padding: 2rem;
                text-align: center;
                transition: all 0.3s ease;
                text-decoration: none;
                color: inherit;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                border: 2px solid transparent;
            " onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 8px 30px rgba(46,204,113,0.3)'; this.style.borderColor='#2ecc71';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.1)'; this.style.borderColor='transparent';">
                <div style="font-size: 3rem; color: #2ecc71; margin-bottom: 1rem;">‚úèÔ∏è</div>
                <h3 style="color: #2c3e50; margin-bottom: 0.8rem; font-size: 1.3rem;">Share a Story</h3>
                <p style="color: #666; font-size: 0.95rem; margin: 0;">Tell donors about your impact and success stories</p>
            </a>
            
            <a href="{{ url_for('add_urgent_requirement') }}" style="
                background: white;
                border-radius: 15px;
                padding: 2rem;
                text-align: center;
                transition: all 0.3s ease;
                text-decoration: none;
                color: inherit;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                border: 2px solid transparent;
            " onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 8px 30px rgba(231,76,60,0.3)'; this.style.borderColor='#e74c3c';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.1)'; this.style.borderColor='transparent';">
                <div style="font-size: 3rem; color: #e74c3c; margin-bottom: 1rem;">üö®</div>
                <h3 style="color: #2c3e50; margin-bottom: 0.8rem; font-size: 1.3rem;">Post Urgent Need</h3>
                <p style="color: #666; font-size: 0.95rem; margin: 0;">Request immediate help for critical situations</p>
            </a>
            
            <div onclick="showProfile()" style="
                background: white;
                border-radius: 15px;
                padding: 2rem;
                text-align: center;
                transition: all 0.3s ease;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                border: 2px solid transparent;
            " onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 8px 30px rgba(52,152,219,0.3)'; this.style.borderColor='#3498db';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.1)'; this.style.borderColor='transparent';">
                <div style="font-size: 3rem; color: #3498db; margin-bottom: 1rem;">üë§</div>
                <h3 style="color: #2c3e50; margin-bottom: 0.8rem; font-size: 1.3rem;">Update Profile</h3>
                <p style="color: #666; font-size: 0.95rem; margin: 0;">Manage your organization information</p>
            </div>
            
            <div onclick="showReports()" style="
                background: white;
                border-radius: 15px;
                padding: 2rem;
                text-align: center;
                transition: all 0.3s ease;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                border: 2px solid transparent;
            " onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 8px 30px rgba(243,156,18,0.3)'; this.style.borderColor='#f39c12';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.1)'; this.style.borderColor='transparent';">
                <div style="font-size: 3rem; color: #f39c12; margin-bottom: 1rem;">üìä</div>
                <h3 style="color: #2c3e50; margin-bottom: 0.8rem; font-size: 1.3rem;">View Reports</h3>
                <p style="color: #666; font-size: 0.95rem; margin: 0;">Track your fundraising progress</p>
            </div>
        </div>
    </div>
</section>

<!-- Recent Donations -->
<section style="margin: 3rem auto; max-width: 1200px;">
    <div class="card" style="padding: 2.5rem;">
        <h2 style="color: #2c3e50; margin-bottom: 2rem; font-size: 2rem;">
            üìà Recent Donations
        </h2>
        
        {% if donations %}
            <div style="overflow-x: auto;">
                <table style="
                    width: 100%;
                    border-collapse: collapse;
                    background: white;
                    border-radius: 10px;
                    overflow: hidden;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                ">
                    <thead>
                        <tr style="background: linear-gradient(45deg, #667eea, #764ba2); color: white;">
                            <th style="padding: 1rem; text-align: left; font-weight: 600;">Donor</th>
                            <th style="padding: 1rem; text-align: left; font-weight: 600;">Amount</th>
                            <th style="padding: 1rem; text-align: left; font-weight: 600;">Date</th>
                            <th style="padding: 1rem; text-align: left; font-weight: 600;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for donation in donations[:10] %}
                        <tr style="border-bottom: 1px solid #f0f0f0; transition: all 0.3s ease;" 
                            onmouseover="this.style.backgroundColor='#f8f9fa'; this.style.transform='scale(1.01)';" 
                            onmouseout="this.style.backgroundColor='white'; this.style.transform='scale(1)';">
                            <td style="padding: 1rem; color: #2c3e50; font-weight: 500;">
                                <i class="fas fa-user-circle" style="color: #667eea; margin-right: 0.5rem;"></i>
                                {{ donation[0].split('@')[0]|title }}
                            </td>
                            <td style="padding: 1rem; font-weight: 700; color: #2c3e50; font-size: 1.1rem;">
                                ‚Çπ{{ donation[1]|int }}
                            </td>
                            <td style="padding: 1rem; color: #666;">{{ donation[2][:10] }}</td>
                            <td style="padding: 1rem;">
                                {% if donation[3] == 'completed' %}
                                    <span style="
                                        color: #2ecc71;
                                        font-weight: 600;
                                        display: flex;
                                        align-items: center;
                                        gap: 0.3rem;
                                    ">
                                        <i class="fas fa-check-circle"></i> Completed
                                    </span>
                                {% else %}
                                    <span style="
                                        color: #f39c12;
                                        font-weight: 600;
                                        display: flex;
                                        align-items: center;
                                        gap: 0.3rem;
                                    ">
                                        <i class="fas fa-clock"></i> {{ donation[3]|title }}
                                    </span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            {% if donations|length > 10 %}
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn" onclick="showAllDonations()" style="
                        padding: 12px 25px;
                        display: inline-flex;
                        align-items: center;
                        gap: 0.5rem;
                    ">
                        <i class="fas fa-list"></i> View All Donations
                    </button>
                </div>
            {% endif %}
        {% else %}
            <div style="
                text-align: center;
                padding: 3rem 2rem;
                color: #666;
                background: white;
                border-radius: 15px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            ">
                <div style="font-size: 4rem; margin-bottom: 1.5rem; color: #ddd;">üì≠</div>
                <h3 style="color: #2c3e50; margin-bottom: 1rem;">No Donations Yet</h3>
                <p style="margin-bottom: 2rem; font-size: 1.1rem; line-height: 1.6;">
                    Start sharing your story to attract donors to your cause and begin making an impact.
                </p>
                <a href="{{ url_for('add_story') }}" class="btn" style="
                    padding: 15px 30px;
                    font-size: 1.1rem;
                    display: inline-flex;
                    align-items: center;
                    gap: 0.5rem;
                ">
                    <i class="fas fa-pen"></i> Share Your First Story
                </a>
            </div>
        {% endif %}
    </div>
</section>

{% if not ngo[10] %}
<!-- Verification Pending Notice -->
<section style="margin: 3rem auto; max-width: 800px;">
    <div style="
        background: white;
        border-left: 6px solid #f39c12;
        border-radius: 20px;
        padding: 2.5rem;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        border-right: 1px solid rgba(255, 255, 255, 0.18);
        border-top: 1px solid rgba(255, 255, 255, 0.18);
        border-bottom: 1px solid rgba(255, 255, 255, 0.18);
    ">
        <h2 style="
            color: #f39c12;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.8rem;
        ">
            <i class="fas fa-hourglass-half"></i> Verification in Progress
        </h2>
        <p style="color: #2c3e50; margin-bottom: 2rem; font-size: 1.1rem; line-height: 1.6;">
            Your NGO is currently under review. Our team is verifying your details with NITI Aayog database.
            This process typically takes 24-48 hours.
        </p>
        <div style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        ">
            <div style="
                display: flex;
                align-items: center;
                gap: 0.8rem;
                padding: 1rem;
                background: rgba(46, 204, 113, 0.1);
                border-radius: 10px;
                border: 2px solid rgba(46, 204, 113, 0.2);
            ">
                <i class="fas fa-check" style="color: #27ae60; font-size: 1.3rem;"></i>
                <span style="color: #27ae60; font-weight: 600;">Documents Submitted</span>
            </div>
            <div style="
                display: flex;
                align-items: center;
                gap: 0.8rem;
                padding: 1rem;
                background: rgba(243, 156, 18, 0.1);
                border-radius: 10px;
                border: 2px solid rgba(243, 156, 18, 0.2);
            ">
                <i class="fas fa-clock" style="color: #f39c12; font-size: 1.3rem;"></i>
                <span style="color: #f39c12; font-weight: 600;">Under Review</span>
            </div>
            <div style="
                display: flex;
                align-items: center;
                gap: 0.8rem;
                padding: 1rem;
                background: rgba(149, 165, 166, 0.1);
                border-radius: 10px;
                border: 2px solid rgba(149, 165, 166, 0.2);
            ">
                <i class="fas fa-certificate" style="color: #95a5a6; font-size: 1.3rem;"></i>
                <span style="color: #95a5a6; font-weight: 600;">Approval Pending</span>
            </div>
        </div>
    </div>
</section>
{% endif %}

{% endif %}

<style>
@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

.card {
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-3px);
    box-shadow: 0 20px 40px rgba(31, 38, 135, 0.3);
}
</style>

<script>
// Functions for quick actions
function showProfile() {
    // Create a more stylish alert
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        backdrop-filter: blur(5px);
    `;
    
    modal.innerHTML = `
        <div style="
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        ">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üë§</div>
            <h3 style="color: #2c3e50; margin-bottom: 1rem;">Profile Management</h3>
            <p style="color: #666; margin-bottom: 2rem;">This feature will be available soon! You'll be able to update your organization details, add team members, and more.</p>
            <button onclick="this.closest('div').parentElement.remove()" style="
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 10px 25px;
                border-radius: 25px;
                cursor: pointer;
            ">Got it!</button>
        </div>
    `;
    
    document.body.appendChild(modal);
}

function showReports() {
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        backdrop-filter: blur(5px);
    `;
    
    modal.innerHTML = `
        <div style="
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        ">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üìä</div>
            <h3 style="color: #2c3e50; margin-bottom: 1rem;">Detailed Reports</h3>
            <p style="color: #666; margin-bottom: 2rem;">Coming soon! You'll get comprehensive analytics, donation trends, impact reports, and more insights about your fundraising.</p>
            <button onclick="this.closest('div').parentElement.remove()" style="
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 10px 25px;
                border-radius: 25px;
                cursor: pointer;
            ">Got it!</button>
        </div>
    `;
    
    document.body.appendChild(modal);
}

function showAllDonations() {
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        backdrop-filter: blur(5px);
    `;
    
    modal.innerHTML = `
        <div style="
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        ">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üìã</div>
            <h3 style="color: #2c3e50; margin-bottom: 1rem;">Complete History</h3>
            <p style="color: #666; margin-bottom: 2rem;">Full donation history with advanced filtering and export options coming soon!</p>
            <button onclick="this.closest('div').parentElement.remove()" style="
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 10px 25px;
                border-radius: 25px;
                cursor: pointer;
            ">Got it!</button>
        </div>
    `;
    
    document.body.appendChild(modal);
}

// Entrance animations
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.card');
    
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = 'all 0.8s ease';
        
        setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 200);
    });

    // Auto-refresh notification (visual only for demo)
    setInterval(() => {
        console.log('Dashboard refreshed - stats updated!');
    }, 30000);
});
</script>
{% endblock %}