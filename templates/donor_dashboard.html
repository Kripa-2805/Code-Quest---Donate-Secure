{% extends "base.html" %}

{% block title %}Donor Dashboard{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 0 1rem;">
    <!-- Welcome Header -->
    <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; margin-bottom: 2rem;">
        <h1 style="color: white; margin-bottom: 1rem; font-size: 2.2rem; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.3);">
            ‚ù§Ô∏è Welcome, {{ session.email.split('@')[0].title() }}!
        </h1>
        <p style="font-size: 1.1rem; color: rgba(255,255,255,0.9); line-height: 1.5;">
            Thank you for being a part of our community. Your generosity makes a real difference.
        </p>
    </div>

    <!-- Quick Stats -->
    <div class="card" style="background: rgba(255, 255, 255, 0.9); margin-bottom: 2rem;">
        <h3 style="text-align: center; color: #2c3e50; margin-bottom: 2rem; font-size: 1.6rem;">
            üìä Platform Impact
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem;">
            <div style="text-align: center; padding: 1rem;">
                <div style="font-size: 2.2rem; font-weight: bold; color: #667eea; margin-bottom: 0.5rem;">‚Çπ25L+</div>
                <div style="color: #2c3e50; font-size: 0.9rem;">Total Donations</div>
            </div>
            <div style="text-align: center; padding: 1rem;">
                <div style="font-size: 2.2rem; font-weight: bold; color: #f093fb; margin-bottom: 0.5rem;">1,250+</div>
                <div style="color: #2c3e50; font-size: 0.9rem;">Active Donors</div>
            </div>
            <div style="text-align: center; padding: 1rem;">
                <div style="font-size: 2.2rem; font-weight: bold; color: #2ecc71; margin-bottom: 0.5rem;">89</div>
                <div style="color: #2c3e50; font-size: 0.9rem;">Verified NGOs</div>
            </div>
            <div style="text-align: center; padding: 1rem;">
                <div style="font-size: 2.2rem; font-weight: bold; color: #f39c12; margin-bottom: 0.5rem;">15K+</div>
                <div style="color: #2c3e50; font-size: 0.9rem;">Lives Impacted</div>
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="card" style="margin-bottom: 2rem;">
        <h3 style="color: #2c3e50; margin-bottom: 1.5rem; font-size: 1.4rem;">
            üîç Find NGOs
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; align-items: end;">
            <div style="position: relative;">
                <input type="text" id="searchInput" placeholder="Search NGOs by name or location..." 
                       style="width: 100%; padding: 12px 45px 12px 15px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 25px; background: rgba(255, 255, 255, 0.9); font-size: 1rem; transition: all 0.3s ease;">
                <span style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #667eea;">üîç</span>
            </div>
            <select id="locationFilter" style="padding: 12px 15px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 10px; background: rgba(255, 255, 255, 0.9); font-size: 1rem;">
                <option value="">All Locations</option>
                {% for ngo in ngos %}
                    <option value="{{ ngo[2] }}">{{ ngo[2] }}</option>
                {% endfor %}
            </select>
            <button class="btn" onclick="clearFilters()" style="padding: 12px 24px; font-size: 1rem;">
                ‚ùå Clear Filters
            </button>
        </div>
    </div>

    <!-- NGO Listing -->
    <div class="card">
        <h2 style="text-align: center; color: #2c3e50; margin-bottom: 2rem; font-size: 1.8rem;">
            üè¢ Verified NGOs
            <span style="font-size: 1rem; color: #2c3e50; font-weight: normal;">({{ ngos|length }} organizations)</span>
        </h2>

        {% if ngos %}
            <div id="ngoGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 2rem; margin: 2rem 0;">
                {% for ngo in ngos %}
                <div class="ngo-card" data-name="{{ ngo[1].lower() }}" data-location="{{ ngo[2].lower() }}" 
                     style="background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(15px); border-radius: 20px; padding: 2rem; border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    
                    <!-- Verified Badge -->
                    <div style="position: absolute; top: 1rem; right: 1rem; background: linear-gradient(45deg, #2ecc71, #27ae60); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.8rem; font-weight: 500; box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);">
                        ‚úÖ Verified
                    </div>
                    
                    <!-- NGO Header -->
                    <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                        <div style="width: 60px; height: 60px; background: linear-gradient(45deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: bold; margin-right: 1rem;">
                            {{ ngo[1][0].upper() }}
                        </div>
                        <div>
                            <h3 style="margin: 0 0 0.5rem 0; color: #fff; font-size: 1.3rem; font-weight: 600; text-shadow: 0 2px 8px rgba(0,0,0,0.3);">{{ ngo[1] }}</h3>
                            <div style="color: rgba(255,255,255,0.9); font-size: 0.9rem; display: flex; align-items: center; gap: 0.3rem;">
                                üìç {{ ngo[2] }}
                            </div>
                        </div>
                    </div>

                    <!-- NGO Stats -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 1.5rem 0;">
                        <div style="text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.8); border-radius: 10px; transition: all 0.3s ease;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">{{ ngo[4] }}</div>
                            <div style="font-size: 0.8rem; color: #2c3e50; text-transform: uppercase; letter-spacing: 1px; font-weight: 500;">Donations</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(255, 255, 255, 0.8); border-radius: 10px; transition: all 0.3s ease;">
                            <div style="font-size: 1.5rem; color: #667eea;">
                                {% if ngo[3] %}
                                    üåê
                                {% else %}
                                    ‚ûñ
                                {% endif %}
                            </div>
                            <div style="font-size: 0.8rem; color: #2c3e50; text-transform: uppercase; letter-spacing: 1px; font-weight: 500;">Website</div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div style="display: flex; gap: 1rem;">
                        <a href="{{ url_for('ngo_details', ngo_id=ngo[0]) }}" 
                           style="flex: 1; background: linear-gradient(45deg, #2672a5, #146093); color: white; padding: 10px 20px; border: none; border-radius: 25px; text-decoration: none; text-align: center; font-weight: 500; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            üëÅÔ∏è View Details
                        </a>
                        <a href="{{ url_for('donate', ngo_id=ngo[0]) }}" 
                           style="flex: 1; background: linear-gradient(45deg, #e74c3c, #c0392b); color: white; padding: 10px 20px; border: none; border-radius: 25px; text-decoration: none; text-align: center; font-weight: 500; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            ‚ù§Ô∏è Donate Now
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="text-align: center; padding: 4rem 2rem; color: #2c3e50;">
                <div style="font-size: 4rem; margin-bottom: 1rem; color: #bbb;">üè¢</div>
                <h3>No Verified NGOs Found</h3>
                <p>There are currently no verified NGOs in our platform. Please check back later.</p>
            </div>
        {% endif %}
    </div>

    <!-- Quick Actions -->
    <div class="card" style="text-align: center; margin-top: 2rem; background: rgba(255, 255, 255, 0.9);">
        <h3 style="color: #2c3e50; margin-bottom: 2rem; font-size: 1.6rem;">
            ‚ö° Quick Actions
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
            <div style="padding: 2rem; background: rgba(52, 152, 219, 0.1); border-radius: 15px; transition: transform 0.3s ease; cursor: pointer;" 
                 onmouseover="this.style.transform='translateY(-5px)'" 
                 onmouseout="this.style.transform='translateY(0)'">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>
                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">Browse All NGOs</h4>
                <p style="color: #2c3e50; font-size: 0.9rem; font-weight: 500;">Explore all verified organizations and their causes</p>
            </div>
            
            <div style="padding: 2rem; background: rgba(231, 76, 60, 0.1); border-radius: 15px; transition: transform 0.3s ease; cursor: pointer;" 
                 onmouseover="this.style.transform='translateY(-5px)'" 
                 onmouseout="this.style.transform='translateY(0)'"
                 onclick="window.location.href='{{ url_for('urgent_requirements') }}'">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üö®</div>
                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">Urgent Needs</h4>
                <p style="color: #2c3e50; font-size: 0.9rem; font-weight: 500;">
                    Help with urgent requirements
                </p>
            </div>
            
            <div style="padding: 2rem; background: rgba(46, 204, 113, 0.1); border-radius: 15px; transition: transform 0.3s ease; cursor: pointer;" 
                 onmouseover="this.style.transform='translateY(-5px)'" 
                 onmouseout="this.style.transform='translateY(0)'"
                 onclick="window.location.href='{{ url_for('stories') }}'">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üìñ</div>
                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">Success Stories</h4>
                <p style="color: #2c3e50; font-size: 0.9rem; font-weight: 500;">
                    Read inspiring stories
                </p>
            </div>
        </div>
    </div>
</div>

<style>
/* Enhanced hover effects for NGO cards */
.ngo-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(31, 38, 135, 0.4);
    border-color: rgba(102, 126, 234, 0.5);
}

/* Focus styles for inputs */
input:focus, select:focus {
    outline: none !important;
    border-color: #667eea !important;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
    transform: translateY(-2px) !important;
}

/* Button hover effects */
.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
}

/* NGO card action buttons hover effects */
.ngo-card a:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

/* Responsive design */
@media (max-width: 768px) {
    #ngoGrid {
        grid-template-columns: 1fr !important;
    }
    
    .card {
        padding: 1.5rem !important;
    }
    
    .ngo-card div[style*="display: flex; gap: 1rem;"] {
        flex-direction: column !important;
    }
    
    h1 {
        font-size: 1.8rem !important;
    }
}

/* Loading animation */
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.loading {
    animation: pulse 1.5s infinite;
}

/* Smooth entrance animations */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.ngo-card {
    animation: slideInUp 0.6s ease forwards;
}
</style>

<script>
// Search and filter functionality
function filterNGOs() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const locationFilter = document.getElementById('locationFilter').value.toLowerCase();
    const ngoCards = document.querySelectorAll('.ngo-card');
    let visibleCount = 0;

    ngoCards.forEach(card => {
        const name = card.getAttribute('data-name');
        const location = card.getAttribute('data-location');
        
        const matchesSearch = name.includes(searchTerm) || location.includes(searchTerm);
        const matchesLocation = !locationFilter || location === locationFilter;
        
        if (matchesSearch && matchesLocation) {
            card.style.display = 'block';
            card.style.opacity = '1';
            card.style.transform = 'scale(1)';
            visibleCount++;
        } else {
            card.style.display = 'none';
        }
    });

    // Handle no results message
    const noResultsMsg = document.getElementById('noResults');
    if (visibleCount === 0 && !noResultsMsg) {
        const ngoGrid = document.getElementById('ngoGrid');
        const noResults = document.createElement('div');
        noResults.id = 'noResults';
        noResults.style.cssText = 'text-align: center; padding: 4rem 2rem; color: #2c3e50; grid-column: 1 / -1;';
        noResults.innerHTML = `
            <div style="font-size: 4rem; margin-bottom: 1rem; color: #bbb;">üîç</div>
            <h3>No NGOs Found</h3>
            <p>Try adjusting your search criteria or clear the filters.</p>
        `;
        ngoGrid.appendChild(noResults);
    } else if (visibleCount > 0 && noResultsMsg) {
        noResultsMsg.remove();
    }
}

function clearFilters() {
    document.getElementById('searchInput').value = '';
    document.getElementById('locationFilter').value = '';
    filterNGOs();
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Filter event listeners
    document.getElementById('searchInput').addEventListener('input', filterNGOs);
    document.getElementById('locationFilter').addEventListener('change', filterNGOs);
    
    // Remove duplicate locations from filter
    const locationFilter = document.getElementById('locationFilter');
    const options = Array.from(locationFilter.options);
    const uniqueOptions = [];
    const seen = new Set();

    options.forEach(option => {
        if (!seen.has(option.value) && option.value !== '') {
            seen.add(option.value);
            uniqueOptions.push(option);
        }
    });

    // Clear and rebuild select
    locationFilter.innerHTML = '<option value="">All Locations</option>';
    uniqueOptions.forEach(option => {
        if (option.value !== '') {
            locationFilter.appendChild(option);
        }
    });

    // Staggered entrance animations
    const ngoCards = document.querySelectorAll('.ngo-card');
    ngoCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = 'all 0.6s ease';
        
        setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
});

// Add loading effect to action buttons
document.addEventListener('click', function(e) {
    if (e.target.closest('.ngo-card a')) {
        const btn = e.target.closest('.ngo-card a');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<span class="loading">‚è≥</span> Loading...';
        btn.style.pointerEvents = 'none';
        
        // Restore after delay for demo
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.pointerEvents = 'auto';
        }, 1000);
    }
});

// Smooth scroll for internal links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});
</script>
{% endblock %}